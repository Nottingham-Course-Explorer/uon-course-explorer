{% extends "base.html.jinja" %}
{% block title %}Module Search{% endblock %}
{% block description %}Search for University of Nottingham modules.{% endblock %}
{% block head %}
	{{ super() }}
	<link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='index.css') }}">
{% endblock %}
{% block main %}
	<h1>Module Search</h1>

	<!-- Search area -->
	<div id="search-area">
		<div id="select-school">
			<label>
				School
				<select name="school" form="search" style="max-width: 305px">
					{% for school in school_options %}
						<option {%- if school == school_query %} selected{% endif %}>{{ school }}</option>
					{% endfor %}
				</select>
			</label>
		</div>

		<div id="select-level">
			<label>
				Level
				<select name="level" form="search">
					<option value="">Any</option>
					{% for level in level_options %}
						<option {%- if level == level_query %} selected{% endif %}>{{ level }}</option>
					{% endfor %}
				</select>
			</label>
		</div>

		<div id="select-semester">
			<label>
				Semester
				<select name="semester" form="search" style="max-width: 150px">
					<option value="">Any</option>
					{% for semester in semester_options %}
						<option {%- if semester == semester_query %} selected{% endif %}>{{ semester }}</option>
					{% endfor %}
				</select>
			</label>
		</div>

		<form id="search" action="/" method="get" hx-boost="true" hx-swap="innerHTML show:no-scroll">
			<label for="name-input">Name</label>
			<input id="name-input" name="name" value="{{ name_query }}">
			<button type="submit" class="btn-primary">Search</button>
		</form>

		<form id="go-to-module"
			  _="on submit
                halt the event
                set input to (first <input/> in me).value
                if input != ''
                  go to url `module/${input}`
				end">
			<label for="code-input">Code</label>
			<input id="code-input" name="code">
			<button type="submit" class="btn-primary">Go</button>
		</form>
	</div>

	<!-- Results list -->
	<table style="width: 100%">
		<thead>
		<tr>
			<td>Code</td>
			<td>Title</td>
			<td>Credits</td>
			<td>Level</td>
		</tr>
		</thead>
		<tbody>
		{% for module in modules %}
			<tr>
				<td>
					{{- module.code -}}
				</td>
				<td>
					<a href="{{ url_for("module_page", code=module.code) }}">
						{{- module.title -}}
					</a>
				</td>
				<td>
					{%- if module.credits != 0 %}
						{{- module.credits -}}
					{%- else -%}
						N/A
					{%- endif -%}
				</td>
				<td>
					{{- module.level -}}
				</td>
			</tr>
		{% endfor %}
		</tbody>
	</table>
	<nav id="pagination">
		<div id="previous-page-grid">
			{% if page != 1 %}
				<a href="{{ modify_parameters(page=page - 1) }}">Previous Page</a>
			{% endif %}
		</div>
		<div id="page-info-grid">
			Page {{ page }} of {{ pages }}
		</div>
		<div id="next-page-grid">
			{% if page != pages %}
				<a href="{{ modify_parameters(page=page + 1) }}">Next Page</a>
			{% endif %}
		</div>
	</nav>
{% endblock %}